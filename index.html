<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="‡∏°‡∏´‡∏≤‡πÄ‡∏Æ‡∏á 99">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png">
    
    <title>‡∏°‡∏´‡∏≤‡πÄ‡∏Æ‡∏á 99 - Ultimate Pro V11</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;600;700&family=Charmonman:wght@400;700&family=Fahkwang:wght@400;600;700&family=Itim&family=Kanit:wght@300;400;600;900&family=KoHo:wght@400;600;700&family=Mali:wght@400;600;700&family=Pattaya&family=Prompt:wght@400;600;900&family=Sriracha&display=swap" rel="stylesheet">

    <style>
        :root {
            /* --- ‡∏Ñ‡πà‡∏≤ Default --- */
            --grid-bg-1: #ffffff; --grid-bg-2: #f0f0f0; --grid-border-color: rgba(0,0,0,0.1); --grid-border-width: 1px; --grid-shape: 12px;
            --grid-shadow-dist: 3px; --grid-shadow-blur: 6px; --grid-shadow-dark: #a3a3a3; --grid-shadow-light: #ffffff;
            --grid-font-family: 'Kanit', sans-serif; --grid-text-color: #333333; --grid-font-size: 1.6rem; --grid-font-weight: 900;
            --grid-text-stroke-color: transparent; --grid-text-stroke-width: 0px;
            --label-bg: #ff4757; --label-text: #ffffff; --label-border: transparent; --label-shape: 5px; --label-scale: 1;
            /* Floating Boxes */
            --p-font: 'Mali', sans-serif; --p-color: #333; --p-size: 1.8rem; --p-weight: 900; --p-stroke: transparent; --p-stroke-w: 0px;
            --t-font: 'Mali', sans-serif; --t-color: #333; --t-size: 1.8rem; --t-weight: 900; --t-stroke: transparent; --t-stroke-w: 0px;
            --b-font: 'Mali', sans-serif; --b-color: #333; --b-size: 1.8rem; --b-weight: 900; --b-stroke: transparent; --b-stroke-w: 0px;
        }

        body { margin: 0; background: #fdf2ad; font-family: 'Kanit', sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding-bottom: 80px; user-select: none; }

        /* Login Screen */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow-y: auto; padding: 20px; box-sizing: border-box; }
        .login-card { background: white; width: 100%; max-width: 450px; padding: 30px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); text-align: center; }
        .app-logo { font-size: 3rem; margin-bottom: 10px; display: block; }
        .app-title { font-size: 2rem; font-weight: 900; background: linear-gradient(45deg, #FF6B6B, #4D96FF); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 5px; }
        .trial-status { font-size: 0.9rem; color: #ff4757; font-weight: bold; margin-bottom: 10px; display: block; background: #fff0f0; padding: 5px; border-radius: 5px; }
        .feature-list { text-align: left; margin: 20px 0; font-size: 0.85rem; color: #555; background: #f8f9fa; padding: 15px; border-radius: 10px; line-height: 1.6; }
        .contact-box { background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-size: 0.9rem; color: #1565c0; text-align: center; border: 1px solid #90caf9; }
        .contact-row { margin-bottom: 5px; font-weight: bold; }
        .login-input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 50px; text-align: center; font-family: 'Kanit'; font-size: 1.1rem; outline: none; transition: 0.3s; margin-bottom: 10px; box-sizing: border-box; }
        .login-input:focus { border-color: #4D96FF; }
        .btn-main { width: 100%; padding: 12px; border: none; border-radius: 50px; font-weight: bold; font-size: 1rem; cursor: pointer; margin-bottom: 10px; font-family: 'Kanit'; transition: 0.2s; }
        .btn-login { background: #4D96FF; color: white; box-shadow: 0 4px 15px rgba(77, 150, 255, 0.3); }
        .btn-trial { background: #2ed573; color: white; box-shadow: 0 4px 15px rgba(46, 213, 115, 0.3); }
        .btn-main:active { transform: scale(0.95); }

        /* Main App */
        #main-content { display: none; width: 100%; flex-direction: column; align-items: center; }
        .board-nav { width: 100%; max-width: 800px; display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; box-sizing: border-box; background: rgba(255,255,255,0.8); border-radius: 20px; margin-top: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .nav-btn { background: #b84cff; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); display: flex; justify-content: center; align-items: center; transition: 0.2s; }
        .nav-btn:active { transform: scale(0.9); }
        .nav-info { font-weight: 900; font-size: 1.2rem; color: #333; cursor: pointer; border-bottom: 2px dashed #ccc; }
        .nav-add { background: #2ed573; } .nav-del { background: #ff4757; width: 30px; height: 30px; font-size: 0.9rem; margin-left: 10px; }
        
        .wrapper { position: relative; width: 100%; max-width: 800px; aspect-ratio: 1 / 1.25; background: #fff url('bg.jpg') no-repeat center top/contain; background-size: 100% 100%; margin-top: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); border-radius: 20px; overflow: hidden; touch-action: pan-y; transition: background-image 0.3s ease; }
        .floating-item { position: absolute; width: 28%; text-align: center; z-index: 80; cursor: grab; }
        .floating-item input { width: 100%; border: none; background: transparent; text-align: center; outline: none; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        #box-price input { font-family: var(--p-font); color: var(--p-color); font-size: var(--p-size); font-weight: var(--p-weight); -webkit-text-stroke: var(--p-stroke-w) var(--p-stroke); }
        #box-top input { font-family: var(--t-font); color: var(--t-color); font-size: var(--t-size); font-weight: var(--t-weight); -webkit-text-stroke: var(--t-stroke-w) var(--t-stroke); }
        #box-bot input { font-family: var(--b-font); color: var(--b-color); font-size: var(--b-size); font-weight: var(--b-weight); -webkit-text-stroke: var(--b-stroke-w) var(--b-stroke); }
        .wrapper.edit-mode .floating-item { border: 2px dashed #ff4757; background: rgba(255, 255, 255, 0.7); border-radius: 10px; animation: pulse 1.5s infinite; }
        .wrapper.edit-mode .floating-item input { pointer-events: none; }
        .edit-hint { display: none; position: absolute; top: 10px; left: 0; width: 100%; text-align: center; background: rgba(0,0,0,0.8); color: #fff; padding: 8px; font-size: 0.9rem; pointer-events: none; z-index: 100; }
        .wrapper.edit-mode .edit-hint { display: block; }
        @keyframes pulse { 0% { border-color: #ff4757; } 50% { border-color: #4D96FF; } 100% { border-color: #ff4757; } }
        
        .date-container { position: absolute; top: 25.5%; left: 48.5%; width: 25%; height: 3.8%; display: flex; align-items: center; justify-content: center; background: #ff4757; border-radius: 50px; border: 2px solid #b33939; box-shadow: 0 4px 0 #b33939; z-index: 90; }
        #dateDisplay { font-size: 0.9rem; font-weight: 900; color: #fff; pointer-events: none; }
        #lottoDate { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 2; }
        .grid { position: absolute; top: 33.5%; left: 4.5%; width: 91%; height: 61%; display: grid; grid-template-columns: repeat(10, 1fr); grid-template-rows: repeat(10, 1fr); gap: 6px; padding: 2px; }
        .num { background: linear-gradient(135deg, var(--grid-bg-1), var(--grid-bg-2)); border: var(--grid-border-width) solid var(--grid-border-color); border-radius: var(--grid-shape); display: flex; justify-content: center; align-items: center; cursor: pointer; position: relative; box-shadow: var(--grid-shadow-dist) var(--grid-shadow-dist) var(--grid-shadow-blur) var(--grid-shadow-dark), calc(var(--grid-shadow-dist)*-1) calc(var(--grid-shadow-dist)*-1) var(--grid-shadow-blur) var(--grid-shadow-light); transition: transform 0.1s; }
        .num:active { transform: scale(0.95); box-shadow: inset 2px 2px 5px rgba(0,0,0,0.1); }
        .num .val { font-family: var(--grid-font-family); color: var(--grid-text-color); font-size: var(--grid-font-size); font-weight: var(--grid-font-weight); -webkit-text-stroke: var(--grid-text-stroke-width) var(--grid-text-stroke-color); }
        .num.booked { background: #e0e0e0 !important; box-shadow: inset 3px 3px 6px rgba(0,0,0,0.1) !important; }
        .num.booked .val { opacity: 0.2; -webkit-text-stroke: 0; color: #888; }
        .num .label { position: absolute; font-size: 9px; font-weight: 900; display: none; z-index: 2; background: var(--label-bg); color: var(--label-text); border: 1px solid var(--label-border); border-radius: var(--label-shape); transform: rotate(-15deg) scale(var(--label-scale)); padding: 2px 5px; box-shadow: 2px 2px 5px rgba(0,0,0,0.2); white-space: nowrap; justify-content: center; align-items: center; }
        .num.booked .label { display: flex !important; }
        
        .admin-section { width: 95%; max-width: 800px; margin-top: 25px; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); box-sizing: border-box; }
        .filter-input { width: 100%; padding: 14px; border: 2px solid #f1f2f6; border-radius: 12px; font-family: 'Kanit'; margin-bottom: 15px; outline: none; box-sizing: border-box; }
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fa; padding: 12px; text-align: left; font-size: 0.85rem; color: #888; border-radius: 8px; }
        td { border-bottom: 1px solid #f1f2f6; padding: 12px; font-size: 0.95rem; white-space: nowrap; }
        .btn-group { display: flex; gap: 10px; margin-top: 25px; flex-wrap: wrap; }
        .admin-btn { padding: 12px; border: none; border-radius: 50px; font-family: 'Kanit'; font-weight: 700; cursor: pointer; flex: 1; min-width: 100px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .admin-btn:active { transform: scale(0.95); }

        /* Modals & UI Elements */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-box { background: white; width: 90%; max-width: 380px; padding: 25px; border-radius: 25px; text-align: center; box-shadow: 0 25px 60px rgba(0,0,0,0.3); max-height: 90vh; overflow-y: auto; }
        .modal-input { width: 100%; padding: 14px; margin: 8px 0; border: 2px solid #f1f2f6; border-radius: 12px; font-family: 'Kanit'; outline: none; text-align: center; box-sizing: border-box; font-size: 1.1rem; }
        
        .editor-section { background: #f9f9f9; padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #eee; text-align:left; }
        .editor-head { font-size: 1rem; font-weight: bold; margin-bottom: 10px; color:#555; border-bottom:1px solid #ddd; padding-bottom:5px; }
        .control-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        input[type="color"] { border: none; width: 35px; height: 35px; cursor: pointer; background: none; }
        input[type="range"] { width: 100px; accent-color: #b84cff; }
        select { padding: 5px; border-radius: 5px; border: 1px solid #ddd; font-family: 'Kanit'; font-size: 0.8rem; width: 150px; }
        .preview-box { padding: 20px; background: #f8f9fa; border: 2px dashed #ddd; margin-bottom: 15px; border-radius: 10px; display: flex; justify-content: space-around; align-items: center; }
        .preview-box .num { pointer-events: none; margin: 5px; }
        #previewText { font-size: 2rem; font-weight: bold; pointer-events: none; }
        .bg-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .bg-thumb { width: 100%; aspect-ratio: 1/1.25; object-fit: cover; border-radius: 8px; border: 2px solid #eee; cursor: pointer; transition: 0.2s; }
        .bg-thumb:hover, .bg-thumb.active { border-color: #b84cff; transform: scale(1.05); }

        @media (max-width: 600px) {
            .num .val { font-size: 1.1rem; }
            .floating-item input { font-size: 1.4rem; }
            .grid { gap: 4px; }
        }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-card">
        <span class="app-logo">üé∞</span>
        <div class="app-title">‡∏°‡∏´‡∏≤‡πÄ‡∏Æ‡∏á 99</div>
        <div style="font-size:0.9rem; color:#888; margin-bottom:15px;">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ß‡∏¢‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£</div>
        
        <div id="trial-info" class="trial-status" style="display:none;"></div>

        <div class="feature-list">
            <b>‚ú® ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡πÅ‡∏≠‡∏û‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô:</b>
            <ul>
                <li>‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ú‡∏á‡∏´‡∏ß‡∏¢‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î ‡πÅ‡∏¢‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏¥‡∏™‡∏£‡∏∞</li>
                <li>‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ò‡∏µ‡∏°, ‡∏™‡∏µ, ‡∏ü‡∏≠‡∏ô‡∏ï‡πå, ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡πÉ‡∏à</li>
                <li>‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
                <li>‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</li>
                <li>‚úÖ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</li>
            </ul>
        </div>

        <div class="contact-box">
            <b>üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤ / ‡∏ã‡∏∑‡πâ‡∏≠ Token ‡∏ñ‡∏≤‡∏ß‡∏£</b><br>
            <div class="contact-row"><span>üì± ‡πÇ‡∏ó‡∏£: 093-281-5229</span></div>
            <div class="contact-row"><span>üí¨ Line: @boss0932815229</span></div>
            <div class="contact-row"><span>üíô FB: Rachan Taksin</span></div>
        </div>

        <input type="text" id="tokenInput" class="login-input" placeholder="‡∏Å‡∏£‡∏≠‡∏Å Token ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô">
        <button class="btn-main btn-login" onclick="checkTokenLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        <button id="trialBtn" class="btn-main btn-trial" onclick="startTrial()">‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ 3 ‡∏ß‡∏±‡∏ô</button>
        <div id="login-msg" style="color:red; margin-top:10px; font-size:0.9rem;"></div>
    </div>
</div>

<div id="main-content">
    <div class="board-nav">
        <button class="nav-btn" onclick="prevBoard()">‚ùÆ</button>
        <div style="display:flex; align-items:center;">
            <span id="boardNameDisplay" class="nav-info" onclick="renameBoard()">‡πÅ‡∏ú‡∏á‡∏ó‡∏µ‡πà 1</span>
            <button class="nav-btn nav-del" onclick="deleteCurrentBoard()" id="btnDeleteBoard">üóëÔ∏è</button>
        </div>
        <div style="display:flex; gap:5px;">
            <button class="nav-btn nav-add" onclick="addNewBoard()">+</button>
            <button class="nav-btn" onclick="nextBoard()">‚ùØ</button>
        </div>
    </div>

    <div class="wrapper" id="gameWrapper">
        <div class="edit-hint">üëÜ ‡∏•‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á | ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏µ/‡∏ü‡∏≠‡∏ô‡∏ï‡πå</div>
        
        <div id="box-price" class="floating-item" style="top:15%; left:5%;" data-type="p">
            <input type="text" id="pricePerTicket" value="40" onchange="saveGameSettings()">
        </div>
        <div id="box-top" class="floating-item" style="top:15%; left:38%;" data-type="t">
            <input type="text" id="prizeTop" value="1500" onchange="saveGameSettings()">
        </div>
        <div id="box-bot" class="floating-item" style="top:15%; left:70%;" data-type="b">
            <input type="text" id="prizeBottom" value="1500" onchange="saveGameSettings()">
        </div>

        <div class="date-container">
            <span id="dateDisplay">‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span>
            <input type="date" id="lottoDate">
        </div>
        <div class="grid" id="grid"></div>
    </div>

    <div class="admin-section">
        <div style="font-weight: 900; font-size: 1.4rem; margin-bottom: 15px;">üìä ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ & ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</div>
        <input type="text" id="filterInput" class="filter-input" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏ö‡∏≠‡∏£‡πå/‡∏ä‡∏∑‡πà‡∏≠..." onkeyup="updateAdminTable()">
        
        <div class="table-container">
            <table>
                <thead><tr><th>‡πÄ‡∏ö‡∏≠‡∏£‡πå</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤</th><th>‡∏ß‡∏±‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤</th></tr></thead>
                <tbody id="adminTableBody"></tbody>
                <tfoot><tr style="background:#f8f9fa; font-weight: 900;"><td colspan="2" style="text-align:right;">‡∏£‡∏ß‡∏°:</td><td id="totalSum" style="color:#ff4757; font-size:1.2rem;">0</td><td></td></tr></tfoot>
            </table>
        </div>
        
        <div class="btn-group">
            <button class="admin-btn" style="background:#f1f2f6; color:#333;" onclick="logoutApp()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö / ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Token</button>
            <button class="admin-btn" style="background:#ff4757; color:white;" onclick="resetBoard()">‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏á‡∏ô‡∏µ‡πâ</button>
            <button class="admin-btn" style="background:#2f3542; color:white;" onclick="window.print()">‡∏û‡∏¥‡∏°‡∏û‡πå</button>
            
            <button class="admin-btn" style="background: linear-gradient(45deg, #FF6B6B, #4D96FF); color:white;" onclick="openBgSelector()">üñºÔ∏è ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á</button>
            <button class="admin-btn" style="background: linear-gradient(45deg, #4D96FF, #6BCB77); color:white;" onclick="openGridDesignModal()">üé® ‡∏ò‡∏µ‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>
            <button class="admin-btn" id="btnToggleEdit" style="background: linear-gradient(45deg, #FF9F43, #FF6B6B); color:white;" onclick="toggleEditMode()">üîß ‡∏à‡∏±‡∏î‡∏ß‡∏≤‡∏á</button>
        </div>
    </div>
</div>

<div id="bookingModal" class="modal-overlay">
    <div class="modal-box">
        <div style="font-size: 1.6rem; font-weight: 900; margin-bottom: 15px;">‡πÄ‡∏ö‡∏≠‡∏£‡πå <span id="modalNum" style="color:#b84cff;"></span></div>
        <input type="text" id="inputName" class="modal-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
        <input type="text" id="inputPrice" class="modal-input" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤">
        <button onclick="confirmBooking()" style="background:#2ed573; color:white; padding:15px; border-radius:50px; border:none; width:100%; font-weight:bold; cursor:pointer; margin-top:10px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button onclick="closeModal('bookingModal')" style="background:none; border:none; color:#bbb; cursor:pointer; margin-top:15px;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
</div>

<div id="bgSelectModal" class="modal-overlay">
    <div class="modal-box" style="max-width:450px;">
        <div style="font-size: 1.2rem; font-weight: 900; margin-bottom: 15px; color:#b84cff;">üñºÔ∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á</div>
        <div class="bg-grid" id="bgGridContainer"></div>
        <button onclick="closeModal('bgSelectModal')" style="background:none; border:none; color:#bbb; cursor:pointer; margin-top:20px;">‡∏õ‡∏¥‡∏î</button>
    </div>
</div>

<div id="gridDesignModal" class="modal-overlay">
    <div class="modal-box" style="max-width: 400px; max-height: 85vh;">
        <div style="font-size: 1.2rem; font-weight: 900; margin-bottom: 15px; color:#4D96FF;">üé® ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á</div>
        <div class="preview-box">
            <div style="text-align:center;"><div style="font-size:0.8rem; color:#888; margin-bottom:5px;">‡∏õ‡∏Å‡∏ï‡∏¥</div><div class="num" style="width:70px; height:70px;"><span class="val">00</span></div></div>
            <div style="text-align:center;"><div style="font-size:0.8rem; color:#888; margin-bottom:5px;">‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß</div><div class="num booked" style="width:70px; height:70px;"><span class="val">99</span><span class="label">‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß</span></div></div>
        </div>
        <div style="overflow-y:auto; max-height: 50vh;">
            <div class="editor-section">
                <div class="editor-head">üì¶ ‡∏Å‡∏•‡πà‡∏≠‡∏á & ‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á</div>
                <div class="control-row"><span>‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á:</span><select id="ed-grid-shape" onchange="previewGridDesign()"><option value="0px">‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°</option><option value="12px">‡∏°‡∏∏‡∏°‡∏°‡∏ô</option><option value="50%">‡∏ß‡∏á‡∏Å‡∏•‡∏°</option><option value="0px 50% 50% 50%">‡πÉ‡∏ö‡πÑ‡∏°‡πâ</option><option value="20px 5px 20px 5px">‡∏°‡∏ô‡∏ó‡πÅ‡∏¢‡∏á</option></select></div>
                <div class="control-row"><span>‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á 1:</span> <input type="color" id="ed-bg1" oninput="previewGridDesign()"></div>
                <div class="control-row"><span>‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á 2:</span> <input type="color" id="ed-bg2" oninput="previewGridDesign()"></div>
                <div class="control-row"><span>‡∏Ç‡∏≠‡∏ö:</span> <input type="color" id="ed-border" oninput="previewGridDesign()"></div>
                <div class="control-row"><span>‡∏´‡∏ô‡∏≤‡∏Ç‡∏≠‡∏ö:</span> <input type="range" id="ed-border-w" min="0" max="5" oninput="previewGridDesign()"></div>
                <div class="control-row"><span>‡∏ô‡∏π‡∏ô/‡πÄ‡∏á‡∏≤:</span> <input type="range" id="ed-shadow" min="0" max="20" oninput="previewGridDesign()"></div>
                <div class="control-row"><span>‡πÄ‡∏á‡∏≤‡πÄ‡∏Ç‡πâ‡∏°:</span> <input type="color" id="ed-shadow-dark" oninput="previewGridDesign()"></div>
                <div class="control-row"><span>‡πÄ‡∏á‡∏≤‡∏™‡∏ß‡πà‡∏≤‡∏á:</span> <input type="color" id="ed-shadow-light" oninput="previewGridDesign()"></div>
            </div>
            <div class="editor-section">
                <div class="editor-head">üî§ ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</div>
                <div class="control-row"><span>‡∏ü‡∏≠‡∏ô‡∏ï‡πå:</span><select id="ed-grid-font" onchange="previewGridDesign()"><option value="'Kanit', sans-serif">‡∏Ñ‡∏≤‡∏ô‡∏¥‡∏ï</option><option value="'Mali', sans-serif">‡∏°‡∏≤‡∏•‡∏µ</option><option value="'Sriracha', sans-serif">‡∏®‡∏£‡∏µ‡∏£‡∏≤‡∏ä‡∏≤</option><option value="'Pattaya', sans-serif">‡∏û‡∏±‡∏ó‡∏¢‡∏≤</option><option value="'Chakra Petch', sans-serif">‡∏à‡∏±‡∏Å‡∏£‡πÄ‡∏û‡∏ä‡∏£</option><option value="'Itim', cursive">‡πÑ‡∏≠‡∏ï‡∏¥‡∏°</option><option value="'Charmonman', cursive">‡∏ä‡∏≤‡∏°‡∏ô‡πÅ‡∏°‡∏ô</option><option value="'Fahkwang', sans-serif">‡∏ü‡πâ‡∏≤‡∏Å‡∏ß‡πâ‡∏≤‡∏á</option><option value="'KoHo', sans-serif">‡πÇ‡∏Å‡πã</option><option value="'Prompt', sans-serif">‡∏û‡∏£‡πâ‡∏≠‡∏°</option></select></div>
                <div class="control-row"><span>‡∏™‡∏µ:</span> <input type="color" id="ed-grid-color" oninput="previewGridDesign()"></div>
                <div class="control-row"><span>‡∏Ç‡∏ô‡∏≤‡∏î:</span> <input type="range" id="ed-grid-size" min="10" max="30" oninput="previewGridDesign()"></div>
                <div class="control-row"><span>‡∏´‡∏ô‡∏≤:</span> <input type="range" id="ed-grid-weight" min="100" max="900" step="100" oninput="previewGridDesign()"></div>
                <div class="control-row"><span>‡∏™‡∏µ‡∏Ç‡∏≠‡∏ö‡∏ï‡∏±‡∏ß:</span> <input type="color" id="ed-grid-stroke" oninput="previewGridDesign()"></div>
                <div class="control-row"><span>‡∏´‡∏ô‡∏≤‡∏Ç‡∏≠‡∏ö‡∏ï‡∏±‡∏ß:</span> <input type="range" id="ed-grid-stroke-w" min="0" max="30" oninput="previewGridDesign()"></div>
            </div>
            <div class="editor-section">
                <div class="editor-head">üè∑Ô∏è ‡∏õ‡πâ‡∏≤‡∏¢‡∏à‡∏≠‡∏á</div>
                <div class="control-row"><span>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô:</span> <input type="color" id="ed-label-bg" oninput="previewGridDesign()"></div>
                <div class="control-row"><span>‡∏™‡∏µ‡∏ï‡∏±‡∏ß:</span> <input type="color" id="ed-label-text" oninput="previewGridDesign()"></div>
                <div class="control-row"><span>‡∏Ç‡∏≠‡∏ö‡∏õ‡πâ‡∏≤‡∏¢:</span> <input type="color" id="ed-label-border" oninput="previewGridDesign()"></div>
                <div class="control-row"><span>‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á:</span><select id="ed-label-shape" onchange="previewGridDesign()"><option value="0px">‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°</option><option value="5px">‡∏°‡∏∏‡∏°‡∏°‡∏ô</option><option value="50px">‡πÅ‡∏Ñ‡∏õ‡∏ã‡∏π‡∏•</option></select></div>
                <div class="control-row"><span>‡∏Ç‡∏ô‡∏≤‡∏î:</span> <input type="range" id="ed-label-scale" min="5" max="15" oninput="previewGridDesign()"></div>
            </div>
        </div>
        <button onclick="saveGridDesign()" style="background:#2ed573; color:white; padding:12px; border-radius:50px; border:none; width:100%; font-weight:bold; cursor:pointer; margin-top:10px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button onclick="closeModal('gridDesignModal')" style="background:none; border:none; color:#bbb; cursor:pointer; margin-top:10px;">‡∏õ‡∏¥‡∏î</button>
    </div>
</div>

<div id="boxDesignModal" class="modal-overlay">
    <div class="modal-box">
        <div class="preview-box"><span id="previewText">1500</span></div>
        <div class="editor-section">
            <div class="control-row"><span>‡∏ü‡∏≠‡∏ô‡∏ï‡πå:</span><select id="ed-box-font" onchange="previewBoxDesign()"><option value="'Kanit', sans-serif">‡∏Ñ‡∏≤‡∏ô‡∏¥‡∏ï</option><option value="'Mali', sans-serif">‡∏°‡∏≤‡∏•‡∏µ</option><option value="'Sriracha', sans-serif">‡∏®‡∏£‡∏µ‡∏£‡∏≤‡∏ä‡∏≤</option><option value="'Pattaya', sans-serif">‡∏û‡∏±‡∏ó‡∏¢‡∏≤</option><option value="'Chakra Petch', sans-serif">‡∏à‡∏±‡∏Å‡∏£‡πÄ‡∏û‡∏ä‡∏£</option><option value="'Itim', cursive">‡πÑ‡∏≠‡∏ï‡∏¥‡∏°</option><option value="'Charmonman', cursive">‡∏ä‡∏≤‡∏°‡∏ô‡πÅ‡∏°‡∏ô</option><option value="'Fahkwang', sans-serif">‡∏ü‡πâ‡∏≤‡∏Å‡∏ß‡πâ‡∏≤‡∏á</option><option value="'KoHo', sans-serif">‡πÇ‡∏Å‡πã</option><option value="'Prompt', sans-serif">‡∏û‡∏£‡πâ‡∏≠‡∏°</option></select></div>
            <div class="control-row"><span>‡∏™‡∏µ:</span> <input type="color" id="ed-box-color" oninput="previewBoxDesign()"></div>
            <div class="control-row"><span>‡∏Ç‡∏ô‡∏≤‡∏î:</span> <input type="range" id="ed-box-size" min="10" max="60" oninput="previewBoxDesign()"></div>
            <div class="control-row"><span>‡∏´‡∏ô‡∏≤:</span> <input type="range" id="ed-box-weight" min="100" max="900" step="100" oninput="previewBoxDesign()"></div>
            <div class="control-row"><span>‡∏™‡∏µ‡∏Ç‡∏≠‡∏ö:</span> <input type="color" id="ed-box-stroke" oninput="previewBoxDesign()"></div>
            <div class="control-row"><span>‡∏´‡∏ô‡∏≤‡∏Ç‡∏≠‡∏ö:</span> <input type="range" id="ed-box-stroke-w" min="0" max="30" oninput="previewBoxDesign()"></div>
        </div>
        <button onclick="saveBoxDesign()" style="background:#2ed573; color:white; padding:12px; border-radius:50px; border:none; width:100%; font-weight:bold; cursor:pointer;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button onclick="closeModal('boxDesignModal')" style="background:none; border:none; color:#bbb; cursor:pointer; margin-top:10px;">‡∏õ‡∏¥‡∏î</button>
    </div>
</div>

<script>
    // --- Login & Trial Logic ---
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxFUl12KSlond4-TRofHaTgcQhDBjtBNdW4u4qf0Acsn8FqQv1XfCA9qMlGxKBRRoVqgQ/exec";
    const fp = window.screen.width + "x" + window.screen.height + "_" + navigator.platform;
    const loginScreen = document.getElementById("login-screen");
    const mainContent = document.getElementById("main-content");
    const loginMsg = document.getElementById("login-msg");

    function checkLoginStatus() {
        const token = localStorage.getItem("saved_lotto_token");
        const trialExp = localStorage.getItem("trial_exp_date");
        const trialInfo = document.getElementById("trial-info");
        const trialBtn = document.getElementById("trialBtn");

        if (token) {
            verifyToken(token);
        } else {
            loginScreen.style.display = "flex";
            if (trialExp) {
                const expDate = new Date(trialExp);
                const now = new Date();
                if (now > expDate) {
                    loginMsg.innerText = "‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Token ‡∏à‡∏£‡∏¥‡∏á";
                    trialBtn.style.display = "none";
                } else {
                    const daysLeft = Math.ceil((expDate - now) / (1000 * 60 * 60 * 24));
                    trialInfo.style.display = "block";
                    trialInfo.innerText = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${daysLeft} ‡∏ß‡∏±‡∏ô)`;
                    trialBtn.innerText = `‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠ (${daysLeft} ‡∏ß‡∏±‡∏ô)`;
                    trialBtn.onclick = enterApp; 
                    trialBtn.classList.remove("btn-trial");
                    trialBtn.classList.add("btn-login"); 
                }
            }
        }
    }

    function verifyToken(t) {
        fetch(`${SCRIPT_URL}?action=check&token=${t}&fp=${fp}`).then(r=>r.json()).then(d=>{
            if(d.status==="ok") enterApp();
            else { 
                localStorage.removeItem("saved_lotto_token"); 
                location.reload(); 
            }
        }).catch(()=>{
            // enterApp(); // Uncomment for offline testing
            loginMsg.innerText = "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡πá‡∏ï‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ";
        });
    }

    function checkTokenLogin() {
        const t = document.getElementById("tokenInput").value.trim();
        if(!t) return;
        loginMsg.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...";
        fetch(`${SCRIPT_URL}?action=check&token=${t}&fp=${fp}`).then(r=>r.json()).then(d=>{
            if(d.status==="ok") {
                localStorage.setItem("saved_lotto_token", t);
                localStorage.removeItem("trial_exp_date");
                location.reload();
            } else { loginMsg.innerText = "Token ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!"; }
        });
    }

    function startTrial() {
        const expDate = new Date();
        expDate.setDate(expDate.getDate() + 3);
        localStorage.setItem("trial_exp_date", expDate.toISOString());
        alert("‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ 3 ‡∏ß‡∏±‡∏ô!");
        location.reload();
    }

    function enterApp() {
        loginScreen.style.display = "none";
        mainContent.style.display = "flex";
        initApp();
    }

    function logoutApp() {
        if(confirm("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?")) {
            localStorage.removeItem("saved_lotto_token");
            location.reload();
        }
    }

    // --- Core Logic ---
    let boards = [];
    let currentBoardIdx = 0;
    const defaultDesign = { bgImage: "bg.jpg", bg1: "#ffffff", bg2: "#f0f0f0", border: "#eeeeee", borderWidth: 1, gridShape: "12px", shadow: 4, shadowDark: "#a3a3a3", shadowLight: "#ffffff", labelBg: "#ff4757", labelText: "#ffffff", labelBorder: "#ff4757", labelShape: "5px", labelScale: 1, gridFont: "'Kanit', sans-serif", gridColor: "#333333", gridSize: 1.6, gridWeight: 900, gridStroke: "transparent", gridStrokeWidth: 0, pFont: "'Mali', sans-serif", pColor: "#333333", pSize: 1.8, pWeight: 900, pStroke: "transparent", pStrokeWidth: 0, pTop: 15, pLeft: 5, tFont: "'Mali', sans-serif", tColor: "#333333", tSize: 1.8, tWeight: 900, tStroke: "transparent", tStrokeWidth: 0, tTop: 15, tLeft: 38, bFont: "'Mali', sans-serif", bColor: "#333333", bSize: 1.8, bWeight: 900, bStroke: "transparent", bStrokeWidth: 0, bTop: 15, bLeft: 70 };
    const defaultSettings = { price: "40", top: "1500", bottom: "1500" };

    const grid = document.getElementById("grid");
    const dateInput = document.getElementById("lottoDate");
    const dateDisplay = document.getElementById("dateDisplay");

    function initApp() {
        const saved = localStorage.getItem("lotto_multi_boards");
        if(saved) boards = JSON.parse(saved);
        else boards = [{ id: Date.now(), name: "‡πÅ‡∏ú‡∏á‡∏ó‡∏µ‡πà 1", data: {}, settings: {price:"40", top:"1500", bottom:"1500"}, design: defaultDesign }];
        
        if(localStorage.getItem("formattedDate_final")) {
            document.getElementById("dateDisplay").textContent = localStorage.getItem("formattedDate_final");
            document.getElementById("lottoDate").value = localStorage.getItem("rawDate_final");
        }
        document.getElementById("lottoDate").onchange = function() {
            const [y, m, d] = this.value.split("-");
            const fmt = `${d}/${m}/${parseInt(y)+543}`;
            document.getElementById("dateDisplay").textContent = fmt;
            localStorage.setItem("rawDate_final", this.value);
            localStorage.setItem("formattedDate_final", fmt);
        };

        renderBoardUI();
        initDraggable();
        initSwipe();
    }

    function saveAll() { localStorage.setItem("lotto_multi_boards", JSON.stringify(boards)); }

    function renderBoardUI() {
        const b = boards[currentBoardIdx];
        document.getElementById("boardNameDisplay").innerText = b.name;
        applyDesign(b.design);
        document.getElementById("box-price").style.top = b.design.pTop+"%"; document.getElementById("box-price").style.left = b.design.pLeft+"%";
        document.getElementById("box-top").style.top = b.design.tTop+"%"; document.getElementById("box-top").style.left = b.design.tLeft+"%";
        document.getElementById("box-bot").style.top = b.design.bTop+"%"; document.getElementById("box-bot").style.left = b.design.bLeft+"%";
        document.getElementById("pricePerTicket").value = b.settings.price;
        document.getElementById("prizeTop").value = b.settings.top;
        document.getElementById("prizeBottom").value = b.settings.bottom;
        renderGrid();
        updateAdminTable();
    }

    function renderGrid() {
        const g = document.getElementById("grid"); g.innerHTML = "";
        const b = boards[currentBoardIdx];
        for(let i=0; i<100; i++){
            const n = i.toString().padStart(2,"0");
            const d = document.createElement("div"); d.className = "num";
            d.innerHTML = `<span class="val">${n}</span><span class="label">‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß</span>`;
            if(b.data[n]) d.classList.add("booked");
            d.onclick = () => {
                if(!d.classList.contains("booked")){
                    currentNum = n;
                    document.getElementById("modalNum").innerText = n;
                    document.getElementById("inputPrice").value = b.settings.price;
                    document.getElementById("bookingModal").style.display = "flex";
                    setTimeout(()=>document.getElementById("inputName").focus(),100);
                } else { if(confirm("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå "+n+"?")){ delete b.data[n]; saveAll(); renderGrid(); updateAdminTable(); } }
            };
            g.appendChild(d);
        }
    }

    let currentNum = null;
    function confirmBooking() {
        const name = document.getElementById("inputName").value.trim() || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏";
        const price = document.getElementById("inputPrice").value.trim();
        const now = new Date();
        const dateStr = `${now.getDate().toString().padStart(2,'0')}/${(now.getMonth()+1).toString().padStart(2,'0')}/${(now.getFullYear()+543).toString().slice(-2)}`;
        const timeStr = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
        const dateTime = `${dateStr} ${timeStr}`;
        boards[currentBoardIdx].data[currentNum] = { name, price, datetime: dateTime };
        saveAll(); renderGrid(); updateAdminTable(); closeModal('bookingModal');
    }

    function updateAdminTable() {
        const body = document.getElementById("adminTableBody"); body.innerHTML = "";
        let total = 0;
        const data = boards[currentBoardIdx].data;
        const key = document.getElementById("filterInput").value.toLowerCase();
        Object.keys(data).sort().forEach(n => {
            if(n.includes(key) || data[n].name.toLowerCase().includes(key)){
                total += parseFloat(data[n].price.replace(/,/g,'')) || 0;
                body.innerHTML += `<tr><td>${n}</td><td>${data[n].name}</td><td>${data[n].price}</td><td>${data[n].datetime}</td></tr>`;
            }
        });
        document.getElementById("totalSum").innerText = total.toLocaleString();
    }

    function addNewBoard() {
        boards.push({ id: Date.now(), name: "‡πÅ‡∏ú‡∏á‡∏ó‡∏µ‡πà "+(boards.length+1), data: {}, settings: {price:"40", top:"1500", bottom:"1500"}, design: defaultDesign });
        currentBoardIdx = boards.length-1; saveAll(); renderBoardUI();
    }
    function deleteCurrentBoard() { if(boards.length>1 && confirm("‡∏•‡∏ö‡πÅ‡∏ú‡∏á‡∏ô‡∏µ‡πâ?")){ boards.splice(currentBoardIdx,1); currentBoardIdx=Math.max(0, currentBoardIdx-1); saveAll(); renderBoardUI(); } }
    function renameBoard() { const n = prompt("‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏á‡πÉ‡∏´‡∏°‡πà:", boards[currentBoardIdx].name); if(n){ boards[currentBoardIdx].name=n; saveAll(); renderBoardUI(); } }
    function prevBoard() { if(currentBoardIdx>0){ currentBoardIdx--; renderBoardUI(); } }
    function nextBoard() { if(currentBoardIdx<boards.length-1){ currentBoardIdx++; renderBoardUI(); } }
    function initSwipe() {
        let x=0; const w=document.getElementById("gameWrapper");
        w.ontouchstart=e=>x=e.changedTouches[0].clientX;
        w.ontouchend=e=>{ const dx=e.changedTouches[0].clientX-x; if(dx<-50)nextBoard(); else if(dx>50)prevBoard(); };
    }
    function closeModal(id){ document.getElementById(id).style.display="none"; }
    function saveGameSettings() { 
        const s = boards[currentBoardIdx].settings;
        s.price = document.getElementById("pricePerTicket").value;
        s.top = document.getElementById("prizeTop").value;
        s.bottom = document.getElementById("prizeBottom").value;
        saveAll();
    }
    function resetBoard() { if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÅ‡∏ú‡∏á‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) { boards[currentBoardIdx].data = {}; saveAll(); renderGrid(); updateAdminTable(); } }

    function applyDesign(c) {
        const r = document.documentElement.style;
        document.querySelector('.wrapper').style.backgroundImage = `url('${c.bgImage}')`;
        r.setProperty('--grid-bg-1', c.bg1); r.setProperty('--grid-bg-2', c.bg2);
        r.setProperty('--grid-border-color', c.border); r.setProperty('--grid-border-width', c.borderWidth + 'px');
        const sD = c.shadow / 2; const sB = c.shadow * 1.5;
        r.setProperty('--grid-shadow-dist', sD + 'px'); r.setProperty('--grid-shadow-blur', sB + 'px');
        r.setProperty('--grid-shadow-dark', c.shadowDark); r.setProperty('--grid-shadow-light', c.shadowLight);
        r.setProperty('--grid-shape', c.gridShape);
        r.setProperty('--label-bg', c.labelBg); r.setProperty('--label-text', c.labelText);
        r.setProperty('--label-border', c.labelBorder); r.setProperty('--label-shape', c.labelShape); r.setProperty('--label-scale', c.labelScale);
        r.setProperty('--grid-font-family', c.gridFont); r.setProperty('--grid-text-color', c.gridColor);
        r.setProperty('--grid-font-size', c.gridSize + 'rem'); r.setProperty('--grid-font-weight', c.gridWeight);
        r.setProperty('--grid-text-stroke-color', c.gridStroke); r.setProperty('--grid-text-stroke-width', c.gridStrokeWidth + 'px');
        r.setProperty('--p-font', c.pFont); r.setProperty('--p-color', c.pColor); r.setProperty('--p-size', c.pSize + 'rem'); r.setProperty('--p-weight', c.pWeight); r.setProperty('--p-stroke', c.pStroke); r.setProperty('--p-stroke-w', c.pStrokeWidth + 'px');
        r.setProperty('--t-font', c.tFont); r.setProperty('--t-color', c.tColor); r.setProperty('--t-size', c.tSize + 'rem'); r.setProperty('--t-weight', c.tWeight); r.setProperty('--t-stroke', c.tStroke); r.setProperty('--t-stroke-w', c.tStrokeWidth + 'px');
        r.setProperty('--b-font', c.bFont); r.setProperty('--b-color', c.bColor); r.setProperty('--b-size', c.bSize + 'rem'); r.setProperty('--b-weight', c.bWeight); r.setProperty('--b-stroke', c.bStroke); r.setProperty('--b-stroke-w', c.bStrokeWidth + 'px');
    }
    
    let isEditMode = false;
    function toggleEditMode() {
        isEditMode = !isEditMode;
        const wrapper = document.getElementById("gameWrapper");
        const btn = document.getElementById("btnToggleEdit");
        if (isEditMode) { wrapper.classList.add("edit-mode"); btn.innerHTML = "üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å"; btn.style.background = "#2ed573"; }
        else { wrapper.classList.remove("edit-mode"); btn.innerHTML = "üîß ‡∏à‡∏±‡∏î‡∏ß‡∏≤‡∏á"; btn.style.background = "linear-gradient(45deg, #FF9F43, #FF6B6B)"; savePositions(); }
    }
    function savePositions() {
        const d = boards[currentBoardIdx].design;
        d.pTop = parseFloat(document.getElementById("box-price").style.top); d.pLeft = parseFloat(document.getElementById("box-price").style.left);
        d.tTop = parseFloat(document.getElementById("box-top").style.top); d.tLeft = parseFloat(document.getElementById("box-top").style.left);
        d.bTop = parseFloat(document.getElementById("box-bot").style.top); d.bLeft = parseFloat(document.getElementById("box-bot").style.left);
        saveAll();
    }
    function initDraggable() {
        document.querySelectorAll(".floating-item").forEach(el => {
            let dragging = false, x, y, l, t;
            el.onmousedown = e => { if(!isEditMode)return; dragging=true; x=e.clientX; y=e.clientY; l=el.offsetLeft; t=el.offsetTop; };
            window.onmousemove = e => { if(!dragging)return; const dx=e.clientX-x, dy=e.clientY-y; el.style.left=((l+dx)/document.getElementById("gameWrapper").offsetWidth*100)+"%"; el.style.top=((t+dy)/document.getElementById("gameWrapper").offsetHeight*100)+"%"; };
            window.onmouseup = () => dragging=false;
            el.ontouchstart = e => { if(!isEditMode)return; dragging=true; x=e.touches[0].clientX; y=e.touches[0].clientY; l=el.offsetLeft; t=el.offsetTop; };
            el.ontouchmove = e => { if(!dragging)return; e.preventDefault(); const dx=e.touches[0].clientX-x, dy=e.touches[0].clientY-y; el.style.left=((l+dx)/document.getElementById("gameWrapper").offsetWidth*100)+"%"; el.style.top=((t+dy)/document.getElementById("gameWrapper").offsetHeight*100)+"%"; };
            el.ontouchend = () => dragging=false;
            el.onclick = () => { if(isEditMode) openBoxDesignModal(el.getAttribute('data-type')); };
        });
    }

    function openBgSelector() {
        const c = document.getElementById("bgGridContainer"); c.innerHTML = "";
        for (let i = 1; i <= 20; i++) {
            const img = document.createElement("img"); img.src = `Background/bg${i}.jpg`; img.className = "bg-thumb";
            img.onerror = function() { this.style.display = "none"; };
            img.onclick = function() { boards[currentBoardIdx].design.bgImage = this.src; saveAll(); renderBoardUI(); closeModal("bgSelectModal"); };
            c.appendChild(img);
        }
        document.getElementById("bgSelectModal").style.display = "flex";
    }
    let currentEditType = null;
    function openBoxDesignModal(type) {
        currentEditType = type; const d = boards[currentBoardIdx].design;
        document.getElementById("ed-box-font").value = d[type + 'Font']; document.getElementById("ed-box-color").value = d[type + 'Color'];
        document.getElementById("ed-box-size").value = d[type + 'Size'] * 10; document.getElementById("ed-box-weight").value = d[type + 'Weight'];
        document.getElementById("ed-box-stroke").value = d[type + 'Stroke'] === "transparent" ? "#ffffff" : d[type + 'Stroke'];
        document.getElementById("ed-box-stroke-w").value = d[type + 'StrokeWidth'] * 10;
        document.getElementById("previewText").innerText = (type === 'p') ? boards[currentBoardIdx].settings.price : (type === 't') ? boards[currentBoardIdx].settings.top : boards[currentBoardIdx].settings.bottom;
        previewBoxDesign(); document.getElementById("boxDesignModal").style.display = "flex";
    }
    function previewBoxDesign() {
        const p = document.getElementById("previewText").style;
        p.fontFamily = document.getElementById("ed-box-font").value; p.color = document.getElementById("ed-box-color").value;
        p.fontSize = (document.getElementById("ed-box-size").value / 10) + 'rem'; p.fontWeight = document.getElementById("ed-box-weight").value;
        p.webkitTextStroke = (document.getElementById("ed-box-stroke-w").value / 10) + 'px ' + document.getElementById("ed-box-stroke").value;
    }
    function saveBoxDesign() {
        const t = currentEditType; const d = boards[currentBoardIdx].design;
        d[t + 'Font'] = document.getElementById("ed-box-font").value; d[t + 'Color'] = document.getElementById("ed-box-color").value;
        d[t + 'Size'] = document.getElementById("ed-box-size").value / 10; d[t + 'Weight'] = document.getElementById("ed-box-weight").value;
        d[t + 'Stroke'] = document.getElementById("ed-box-stroke").value; d[t + 'StrokeWidth'] = document.getElementById("ed-box-stroke-w").value / 10;
        saveAll(); applyDesign(d); closeModal('boxDesignModal');
    }
    function openGridDesignModal() {
        const d = boards[currentBoardIdx].design;
        document.getElementById("ed-bg1").value = d.bg1; document.getElementById("ed-bg2").value = d.bg2;
        document.getElementById("ed-border").value = d.border; document.getElementById("ed-border-w").value = d.borderWidth;
        document.getElementById("ed-shadow").value = d.shadow; document.getElementById("ed-shadow-dark").value = d.shadowDark; document.getElementById("ed-shadow-light").value = d.shadowLight;
        document.getElementById("ed-grid-shape").value = d.gridShape;
        document.getElementById("ed-label-bg").value = d.labelBg; document.getElementById("ed-label-text").value = d.labelText;
        document.getElementById("ed-label-border").value = d.labelBorder; document.getElementById("ed-label-shape").value = d.labelShape;
        document.getElementById("ed-label-scale").value = d.labelScale * 10;
        document.getElementById("ed-grid-font").value = d.gridFont; document.getElementById("ed-grid-color").value = d.gridColor;
        document.getElementById("ed-grid-size").value = d.gridSize * 10; document.getElementById("ed-grid-weight").value = d.gridWeight;
        document.getElementById("ed-grid-stroke").value = d.gridStroke === "transparent" ? "#ffffff" : d.gridStroke;
        document.getElementById("ed-grid-stroke-w").value = d.gridStrokeWidth * 10;
        document.getElementById("gridDesignModal").style.display = "flex"; previewGridDesign();
    }
    function previewGridDesign() {
        const cfg = { ...boards[currentBoardIdx].design };
        cfg.bg1 = document.getElementById("ed-bg1").value; cfg.bg2 = document.getElementById("ed-bg2").value;
        cfg.border = document.getElementById("ed-border").value; cfg.borderWidth = document.getElementById("ed-border-w").value;
        cfg.shadow = document.getElementById("ed-shadow").value; cfg.shadowDark = document.getElementById("ed-shadow-dark").value; cfg.shadowLight = document.getElementById("ed-shadow-light").value;
        cfg.gridShape = document.getElementById("ed-grid-shape").value;
        cfg.labelBg = document.getElementById("ed-label-bg").value; cfg.labelText = document.getElementById("ed-label-text").value;
        cfg.labelBorder = document.getElementById("ed-label-border").value; cfg.labelShape = document.getElementById("ed-label-shape").value;
        cfg.labelScale = document.getElementById("ed-label-scale").value / 10;
        cfg.gridFont = document.getElementById("ed-grid-font").value; cfg.gridColor = document.getElementById("ed-grid-color").value;
        cfg.gridSize = document.getElementById("ed-grid-size").value / 10; cfg.gridWeight = document.getElementById("ed-grid-weight").value;
        cfg.gridStroke = document.getElementById("ed-grid-stroke").value; cfg.gridStrokeWidth = document.getElementById("ed-grid-stroke-w").value / 10;
        applyDesign(cfg);
    }
    function saveGridDesign() {
        const d = boards[currentBoardIdx].design;
        d.bg1 = document.getElementById("ed-bg1").value; d.bg2 = document.getElementById("ed-bg2").value;
        d.border = document.getElementById("ed-border").value; d.borderWidth = document.getElementById("ed-border-w").value;
        d.shadow = document.getElementById("ed-shadow").value; d.shadowDark = document.getElementById("ed-shadow-dark").value; d.shadowLight = document.getElementById("ed-shadow-light").value;
        d.gridShape = document.getElementById("ed-grid-shape").value;
        d.labelBg = document.getElementById("ed-label-bg").value; d.labelText = document.getElementById("ed-label-text").value;
        d.labelBorder = document.getElementById("ed-label-border").value; d.labelShape = document.getElementById("ed-label-shape").value;
        d.labelScale = document.getElementById("ed-label-scale").value / 10;
        d.gridFont = document.getElementById("ed-grid-font").value; d.gridColor = document.getElementById("ed-grid-color").value;
        d.gridSize = document.getElementById("ed-grid-size").value / 10; d.gridWeight = document.getElementById("ed-grid-weight").value;
        d.gridStroke = document.getElementById("ed-grid-stroke").value; d.gridStrokeWidth = document.getElementById("ed-grid-stroke-w").value / 10;
        saveAll(); closeModal('gridDesignModal');
    }

    checkLoginStatus();
</script>

</body>
</html>
